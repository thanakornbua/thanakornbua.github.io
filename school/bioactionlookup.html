<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ä‡∏µ‡∏ß‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f8fafc; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.7); }
        .result-animate { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <div class="max-w-xl mx-auto">
        <!-- Back Button -->
        <div class="flex items-center justify-start mb-6">
            <button id="backBtn" type="button"
                class="inline-flex items-center gap-2 px-4 py-2 rounded-2xl bg-white/80 border border-slate-100 shadow-sm hover:shadow-md hover:-translate-y-[1px] transition-all text-slate-700"
                aria-label="Return to previous page">
                <span class="text-lg" aria-hidden="true">‚Üê</span>
                <span class="font-bold text-sm">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</span>
                <span class="text-xs text-slate-400">Back</span>
            </button>
        </div>

        <!-- Header -->
        <div class="text-center mb-10">
            <h1 class="text-3xl font-extrabold text-slate-900">üî¨ Biology Group Lookup</h1>
            <p class="text-slate-500 mt-2">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏•‡∏∞‡∏Ñ‡∏£‡πÉ‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏ß‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤ ‡∏´‡πâ‡∏≠‡∏á 501 ‡πÅ‡∏•‡∏∞ 502</p>
        </div>

        <!-- Search Box -->
        <div class="glass-card rounded-3xl p-6 shadow-xl mb-8">
            <div class="flex gap-3 items-center">
                <div class="relative flex-1">
                    <div class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </div>
                    <input type="text" id="searchInput"
                        placeholder="‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß / ‡∏ä‡∏∑‡πà‡∏≠ / ‡∏´‡πâ‡∏≠‡∏á-‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà (‡πÄ‡∏ä‡πà‡∏ô 501-4)"
                        class="w-full pl-12 pr-4 py-4 rounded-2xl border-2 border-slate-100 focus:border-indigo-500 focus:outline-none text-lg transition-all shadow-inner">
                </div>
                <button id="searchButton" class="px-5 py-3 rounded-2xl bg-indigo-600 text-white font-bold shadow-lg hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-200 transition-all">
                    ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                </button>
            </div>
            <p class="text-xs text-slate-400 mt-3 text-center">‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ / ‡∏´‡∏£‡∏∑‡∏≠ - ‡∏Ñ‡∏±‡πà‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ ‡πÄ‡∏ä‡πà‡∏ô 501/32</p>
        </div>

        <!-- Display Area -->
        <div id="displayArea">
            <div id="initialState" class="text-center py-20 opacity-30">
                <p class="text-xl">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...</p>
            </div>

            <div id="resultBox" class="hidden result-animate space-y-4">
                <!-- Profile Card -->
                <div class="bg-indigo-700 rounded-3xl p-8 text-white shadow-2xl relative overflow-hidden">
                    <div class="relative z-10 flex justify-between items-center">
                        <div>
                            <p class="text-indigo-200 text-xs font-bold tracking-widest uppercase">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                            <h2 id="resName" class="text-3xl font-black mt-1 leading-tight"></h2>
                            <p id="resSub" class="text-indigo-100 mt-2 opacity-80"></p>
                            <span id="resStatus" class="hidden"></span>
                        </div>
                        <div class="text-right">
                            <span id="resRoom" class="bg-white text-indigo-700 px-4 py-1 rounded-full font-black text-sm"></span>
                            <div class="mt-4">
                                <p class="text-[10px] uppercase font-bold text-indigo-200">Group</p>
                                <p id="resGroup" class="text-6xl font-black"></p>
                                <p id="resTopic" class="mt-2 text-sm text-indigo-100 font-semibold leading-snug"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Member List -->
                <div class="bg-white rounded-3xl p-6 shadow-lg border border-slate-100">
                    <h3 class="font-bold text-slate-800 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2 text-indigo-500" fill="currentColor" viewBox="0 0 20 20"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a7 7 0 00-7 7v1h11v-1a7 7 0 00-7-7z"></path></svg>
                        ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
                    </h3>
                    <div id="memberGrid" class="space-y-2"></div>
                </div>
            </div>

            <div id="errorState" class="hidden text-center py-10">
                <div class="bg-rose-50 text-rose-500 p-4 rounded-2xl inline-block font-bold">
                    ‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏∞‡∏Å‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { database, groupTopics } from './bioaction-data.js';

        const backBtn = document.getElementById('backBtn');
        if (backBtn) {
            backBtn.addEventListener('click', () => {
                // Prefer real browser back, fallback to timetable.
                if (window.history.length > 1) {
                    window.history.back();
                } else {
                    window.location.href = 'timetable.html';
                }
            });
        }

        const statusStyles = {
            head: {
                label: 'Head of Project',
                classes: 'bg-amber-100 text-amber-800 border-amber-200'
            },
            lucky: {
                label: 'Lucky draw person',
                classes: 'bg-emerald-100 text-emerald-800 border-emerald-200'
            }
        };

        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const initialState = document.getElementById('initialState');
        const resultBox = document.getElementById('resultBox');
        const errorState = document.getElementById('errorState');
        const resStatus = document.getElementById('resStatus');
        const resTopic = document.getElementById('resTopic');

        const runSearch = () => {
            const rawVal = searchInput.value.trim().toLowerCase();
            if (!rawVal) {
                updateUI('initial');
                return;
            }

            let found = null;

            if (rawVal.match(/^[0-9]{3}[/-][0-9]+$/)) {
                const separator = rawVal.includes('/') ? '/' : '-';
                const [roomPart, noPart] = rawVal.split(separator);
                found = database.find(s => s.r === roomPart && s.n === noPart);
            }

            if (!found && rawVal.match(/^[0-9]{5}$/)) {
                found = database.find(s => s.id === rawVal);
            }

            if (!found && rawVal.length >= 2) {
                found = database.find(s => s.name.toLowerCase().includes(rawVal));
            }

            if (!found && rawVal.match(/^[0-9]{1,2}$/)) {
                found = database.find(s => s.n === rawVal);
            }

            if (found) {
                displayResult(found);
            } else {
                updateUI('error');
            }
        };

        searchButton.addEventListener('click', runSearch);
        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') runSearch();
        });

        function updateUI(state) {
            initialState.classList.add('hidden');
            resultBox.classList.add('hidden');
            errorState.classList.add('hidden');

            if (state === 'initial') initialState.classList.remove('hidden');
            if (state === 'error') errorState.classList.remove('hidden');
            if (state === 'result') resultBox.classList.remove('hidden');
        }

        function renderStatusBadge(element, status, baseClasses) {
            const meta = statusStyles[status];
            if (!meta) {
                element.className = 'hidden';
                element.textContent = '';
                return;
            }

            element.textContent = meta.label;
            element.className = `${baseClasses} ${meta.classes}`;
        }

        function buildStatusPill(status) {
            const meta = statusStyles[status];
            if (!meta) return '';
            return `<span class="px-2 py-1 rounded-full border text-[10px] font-bold ${meta.classes}">${meta.label}</span>`;
        }

        function getTopic(room, group) {
            const key = `${room}-${group}`;
            return groupTopics[key] || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏á‡∏≤‡∏ô';
        }

        function displayResult(student) {
            updateUI('result');
            
            document.getElementById('resName').textContent = student.name;
            document.getElementById('resSub').textContent = `‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß ${student.id} | ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ${student.n}`;
            document.getElementById('resRoom').textContent = `‡∏´‡πâ‡∏≠‡∏á ${student.r}`;
            document.getElementById('resGroup').textContent = student.g;
            resTopic.textContent = getTopic(student.r, student.g);
            renderStatusBadge(resStatus, student.status, 'mt-3 inline-flex items-center gap-2 px-3 py-1 rounded-full border text-xs font-bold');

            const members = database.filter(s => s.r === student.r && s.g === student.g);
            members.sort((a, b) => parseInt(a.n) - parseInt(b.n));

            const grid = document.getElementById('memberGrid');
            grid.innerHTML = '';

            members.forEach(m => {
                const isCurrent = m.id === student.id;
                const item = document.createElement('div');
                item.className = `flex justify-between p-3 rounded-xl border text-sm transition-all ${
                    isCurrent ? 'bg-indigo-50 border-indigo-200 ring-2 ring-indigo-100 scale-[1.02]' : 'bg-white border-slate-100 text-slate-600'
                }`;

                const statusPill = buildStatusPill(m.status);

                item.innerHTML = `
                    <div class="flex items-center">
                        <span class="w-6 h-6 flex items-center justify-center rounded-lg bg-slate-100 text-slate-400 font-bold mr-3 text-xs">
                            ${m.n}
                        </span>
                        <span class="${isCurrent ? 'font-bold text-indigo-700' : ''}">${m.name}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        ${statusPill}
                        ${isCurrent ? '<span class="text-[10px] font-black text-indigo-400 self-center uppercase tracking-tighter">You</span>' : ''}
                    </div>
                `;
                grid.appendChild(item);
            });
        }
    </script>
</body>
</html>

